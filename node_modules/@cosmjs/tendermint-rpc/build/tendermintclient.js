"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isTendermint37Client = isTendermint37Client;
exports.isComet38Client = isComet38Client;
exports.isComet1Client = isComet1Client;
exports.connectComet = connectComet;
const comet1_1 = require("./comet1");
const comet38_1 = require("./comet38");
const tendermint37_1 = require("./tendermint37");
function isTendermint37Client(client) {
    return client instanceof tendermint37_1.Tendermint37Client;
}
function isComet38Client(client) {
    return client instanceof comet38_1.Comet38Client;
}
function isComet1Client(client) {
    return client instanceof comet1_1.Comet1Client;
}
/**
 * Auto-detects the version of the backend and uses a suitable client.
 */
async function connectComet(endpoint) {
    // Tendermint/CometBFT 0.37/0.38/1.x auto-detection. Starting with 0.37 we seem to get reliable versions again ðŸŽ‰
    // Using 0.37 as the fallback.
    let out;
    const tm37Client = await tendermint37_1.Tendermint37Client.connect(endpoint);
    const version = (await tm37Client.status()).nodeInfo.version;
    if (version.startsWith("0.37.")) {
        out = tm37Client;
    }
    else if (version.startsWith("0.38.")) {
        tm37Client.disconnect();
        out = await comet38_1.Comet38Client.connect(endpoint);
    }
    else if (version.startsWith("1.")) {
        tm37Client.disconnect();
        out = await comet1_1.Comet1Client.connect(endpoint);
    }
    else {
        out = tm37Client;
    }
    return out;
}
//# sourceMappingURL=tendermintclient.js.map